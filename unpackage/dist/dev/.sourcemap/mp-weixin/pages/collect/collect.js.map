{"version":3,"file":"collect.js","sources":["pages/collect/collect.vue","../../HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29sbGVjdC9jb2xsZWN0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 表型采集 -->\n    <view v-if=\"taskType === 'phenotype'\">\n      <!-- 双目相机图像展示 -->\n      <view class=\"camera-preview\">\n        <image :src=\"leftImage\" class=\"camera-image\" mode=\"aspectFill\" />\n        <image :src=\"rightImage\" class=\"camera-image\" mode=\"aspectFill\" />\n      </view>\n\n      <!-- 图像信息 -->\n      <view class=\"info-panel\">\n        <view class=\"info-item\"><text>经度：</text>{{ longitude }}</view>\n        <view class=\"info-item\"><text>纬度：</text>{{ latitude }}</view>\n        <view class=\"info-item\"><text>高程：</text>{{ altitude }}</view>\n        <view class=\"info-item\"><text>小区 ID：</text>{{ plotId }}</view>\n      </view>\n    </view>\n\n    <!-- 玉米烤种 -->\n    <view v-else-if=\"taskType === 'roast'\">\n      <!-- 图像展示 -->\n      <view class=\"image-preview\">\n        <image :src=\"imageSrc\" class=\"display-image\" mode=\"aspectFill\" />\r\n\t\t<!-- 相机预览区域 -->\r\n\t\t    <view class=\"camera-container\" v-if=\"showCamera\">\r\n\t\t     <camera \r\n\t\t       class=\"camera\" \r\n\t\t       device-position=\"back\" \r\n\t\t       flash=\"off\"\r\n\t\t       style=\"height: 70vh;\"\r\n\t\t       ref=\"cameraCtx\"\r\n\t\t     ></camera>\r\n\r\n\t\t      <!-- 九宫格辅助线 -->\r\n\t\t      <view class=\"grid-overlay\">\r\n\t\t        <view class=\"grid-line vertical-line-1\"></view>\r\n\t\t        <view class=\"grid-line vertical-line-2\"></view>\r\n\t\t        <view class=\"grid-line horizontal-line-1\"></view>\r\n\t\t        <view class=\"grid-line horizontal-line-2\"></view>\r\n\t\t      </view>\r\n\t\t    </view>\n      </view>\n    </view>\n\n    <!-- 操作按钮（通用） -->\n    <view class=\"button-group\">\n      <button @click=\"takePhoto\">拍照</button>\n      <!-- <button @click=\"chooseFromAlbum\">从图库上传</button> -->\n    </view>\n  </view>\n</template>\n\n<script>\n// export default {\n//   data() {\n//     return {\n//       taskType: '',\n\n//       // 表型采集\n//       leftImage: '/static/placeholder-left.jpg',  \n//       rightImage: '/static/placeholder-right.jpg',\n//       longitude: '120.123456',\n//       latitude: '30.654321',\n//       altitude: '50.3m',\n//       plotId: 'A-01',\n// \tshowCamera:'true',\n//       // 玉米烤种\n//       imageSrc: '/static/placeholder-roast.jpg'\n//     };\n//   },\r\n  \n//   onLoad(options) {\n//     this.taskType = options.type || 'phenotype';\n\n//     // 若你希望用真数据替代虚拟数据，可打开以下 getLocation\n//     // if (this.taskType === 'phenotype') {\n//     //   this.getLocation();\n//     // }\n//   },\n//   methods: {\n//     getLocation() {\n//       uni.getLocation({\n//         type: 'wgs84',\n//         success: (res) => {\n//           this.longitude = res.longitude.toFixed(6);\n//           this.latitude = res.latitude.toFixed(6);\n//           this.altitude = (res.altitude || 0).toFixed(1) + 'm';\n//         }\n//       });\n//     },\n//     takePhoto() {\n//       const count = this.taskType === 'phenotype' ? 2 : 1;\n//       uni.chooseImage({\n//         count,\n//         sourceType: ['camera'],\n//         success: (res) => {\n//           if (this.taskType === 'phenotype') {\n//             this.leftImage = res.tempFilePaths[0];\n//             this.rightImage = res.tempFilePaths[1] || res.tempFilePaths[0];\n//           } else {\n//             this.imageSrc = res.tempFilePaths[0];\n//           }\n//         }\n//       });\n//     },\r\n\t\n//     // chooseFromAlbum() {\n//     //   const count = this.taskType === 'phenotype' ? 2 : 1;\n//     //   uni.chooseImage({\n//     //     count,\n//     //     sourceType: ['album'],\n//     //     success: (res) => {\n//     //       if (this.taskType === 'phenotype') {\n//     //         this.leftImage = res.tempFilePaths[0];\n//     //         this.rightImage = res.tempFilePaths[1] || res.tempFilePaths[0];\n//     //       } else {\n//     //         this.imageSrc = res.tempFilePaths[0];\n//     //       }\n//     //     }\n//     //   });\n//     // }\n//   }\n// };\r\nexport default {\n  data() {\n    return {\n      taskType: '',\n\n      // 表型采集\n      leftImage: '/static/placeholder-left.jpg',\n      rightImage: '/static/placeholder-right.jpg',\n      longitude: '120.123456',\n      latitude: '30.654321',\n      altitude: '50.3m',\n      plotId: 'A-01',\n\n      // 玉米烤种\n      imageSrc: '',\n      showCamera: true\n    };\n  },\n\n  onLoad(options) {\n    this.taskType = options.type || 'phenotype';\n    this.plotId = options.plotId || 'A-01';\n\n    if (this.taskType === 'roast') {\n      this.getLocation();\n    }\n  },\n\n  methods: {\n    getLocation() {\n      uni.getLocation({\n        type: 'wgs84',\n        success: (res) => {\n          this.longitude = res.longitude.toFixed(6);\n          this.latitude = res.latitude.toFixed(6);\n          this.altitude = (res.altitude || 0).toFixed(1) + 'm';\n        },\n        fail: () => {\n          uni.showToast({ title: '定位失败', icon: 'none' });\n        }\n      });\n    },\n\n    takePhoto() {\r\n      if (this.taskType === 'phenotype') {\r\n        // 表型采集：选择两个图像\r\n        uni.chooseImage({\r\n          count: 2,\r\n          sourceType: ['camera'],\r\n          success: (res) => {\r\n            this.leftImage = res.tempFilePaths[0];\r\n            this.rightImage = res.tempFilePaths[1] || res.tempFilePaths[0];\r\n          }\r\n        });\r\n      } else if (this.taskType === 'roast') {\r\n        // 烤种：调用 camera 组件拍照\r\n        const cameraCtx = uni.createCameraContext();\r\n        cameraCtx.takePhoto({\r\n          quality: 'high',\r\n          success: (res) => {\r\n            this.imageSrc = res.tempImagePath;\r\n            this.showCamera = false;  // 拍完照关闭相机预览\r\n    \r\n            const imageData = {\r\n              id: Date.now(),\r\n              url: res.tempImagePath,\r\n              longitude: this.longitude,\r\n              latitude: this.latitude,\r\n              altitude: this.altitude,\r\n              blockId: this.plotId,\r\n              uploadStatus: 'notUploaded',\r\n              selected: false,\r\n              progress: 0,\r\n              showProgress: false\r\n            };\r\n    \r\n            // 返回上一级页面并传递数据\r\n            const pages = getCurrentPages();\r\n            const prevPage = pages[pages.length - 2];\r\n            uni.navigateBack();\r\n            setTimeout(() => {\r\n              prevPage.$emit('imageAdded', imageData);\r\n            }, 100);\r\n          },\r\n          fail: (err) => {\r\n            console.error('拍照失败', err);\r\n            uni.showToast({ title: '拍照失败', icon: 'none' });\r\n          }\r\n        });\r\n      }\r\n    }\r\n\n  }\n};\n\n</script>\n\n<style scoped>\n.container {\n  padding: 20rpx;\n}\n.camera-preview {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 20rpx;\r\n \r\n  \n}\n.camera-image {\n  width: 48%;\n  height: 500rpx;\n  background-color: #f0f0f0;\n  border-radius: 10rpx;\n}\n.image-preview {\n  width: 100%;\n  height: 400rpx;\n  background-color: #f0f0f0;\n  margin-bottom: 40rpx;\n  border-radius: 12rpx;\n}\n.display-image {\n  width: 100%;\n  height: 100%;\n  border-radius: 12rpx;\n}\n.info-panel {\n  margin-top: 100rpx;\n  font-size: 40rpx;\n  color: #333;\r\n  text-align: center;\n}\n.info-item {\n  margin-bottom: 30rpx;\n}\n.button-group {\n  margin-top: 90rpx;\n  display: flex;\n  justify-content: space-around;\n}\nbutton {\n  width: 95%;\n  height: 80rpx;\n  font-size: 36rpx;\n  background-color: #f8e620;\n  color: black;\n  border-radius: 12rpx;\n}\r\n/* 九宫格样式 */\n.grid-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  pointer-events: none;\n}\n.grid-line {\n  position: absolute;\n  background-color: rgba(255, 255, 255, 0.5);\n}\n.vertical-line-1 {\n  width: 1px;\n  height: 100%;\n  left: 33.33%;\n}\n.vertical-line-2 {\n  width: 1px;\n  height: 100%;\n  left: 66.66%;\n}\n.horizontal-line-1 {\n  width: 100%;\n  height: 1px;\n  top: 33.33%;\n}\n.horizontal-line-2 {\n  width: 100%;\n  height: 1px;\n  top: 66.66%;\n}\r\n.camera-container{\r\n\tposition: relative;\r\n}\n</style>\n","import MiniProgramPage from 'D:/狮山云瞳/狮山云瞳/pages/collect/collect.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AA4HA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA;AAAA,MAGV,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,WAAW;AAAA,MACX,UAAU;AAAA,MACV,UAAU;AAAA,MACV,QAAQ;AAAA;AAAA,MAGR,UAAU;AAAA,MACV,YAAY;AAAA;EAEf;AAAA,EAED,OAAO,SAAS;AACd,SAAK,WAAW,QAAQ,QAAQ;AAChC,SAAK,SAAS,QAAQ,UAAU;AAEhC,QAAI,KAAK,aAAa,SAAS;AAC7B,WAAK,YAAW;AAAA,IAClB;AAAA,EACD;AAAA,EAED,SAAS;AAAA,IACP,cAAc;AACZA,oBAAAA,MAAI,YAAY;AAAA,QACd,MAAM;AAAA,QACN,SAAS,CAAC,QAAQ;AAChB,eAAK,YAAY,IAAI,UAAU,QAAQ,CAAC;AACxC,eAAK,WAAW,IAAI,SAAS,QAAQ,CAAC;AACtC,eAAK,YAAY,IAAI,YAAY,GAAG,QAAQ,CAAC,IAAI;AAAA,QAClD;AAAA,QACD,MAAM,MAAM;AACVA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,QAC/C;AAAA,MACF,CAAC;AAAA,IACF;AAAA,IAED,YAAY;AACV,UAAI,KAAK,aAAa,aAAa;AAEjCA,sBAAAA,MAAI,YAAY;AAAA,UACd,OAAO;AAAA,UACP,YAAY,CAAC,QAAQ;AAAA,UACrB,SAAS,CAAC,QAAQ;AAChB,iBAAK,YAAY,IAAI,cAAc,CAAC;AACpC,iBAAK,aAAa,IAAI,cAAc,CAAC,KAAK,IAAI,cAAc,CAAC;AAAA,UAC/D;AAAA,QACF,CAAC;AAAA,MACH,WAAW,KAAK,aAAa,SAAS;AAEpC,cAAM,YAAYA,oBAAI;AACtB,kBAAU,UAAU;AAAA,UAClB,SAAS;AAAA,UACT,SAAS,CAAC,QAAQ;AAChB,iBAAK,WAAW,IAAI;AACpB,iBAAK,aAAa;AAElB,kBAAM,YAAY;AAAA,cAChB,IAAI,KAAK,IAAK;AAAA,cACd,KAAK,IAAI;AAAA,cACT,WAAW,KAAK;AAAA,cAChB,UAAU,KAAK;AAAA,cACf,UAAU,KAAK;AAAA,cACf,SAAS,KAAK;AAAA,cACd,cAAc;AAAA,cACd,UAAU;AAAA,cACV,UAAU;AAAA,cACV,cAAc;AAAA;AAIhB,kBAAM,QAAQ;AACd,kBAAM,WAAW,MAAM,MAAM,SAAS,CAAC;AACvCA,0BAAG,MAAC,aAAY;AAChB,uBAAW,MAAM;AACf,uBAAS,MAAM,cAAc,SAAS;AAAA,YACvC,GAAE,GAAG;AAAA,UACP;AAAA,UACD,MAAM,CAAC,QAAQ;AACbA,0BAAA,MAAA,MAAA,SAAA,oCAAc,QAAQ,GAAG;AACzBA,0BAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,UAC/C;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EAEF;AACF;;;;;;;;;;;;;;;;;;;;ACxNA,GAAG,WAAW,eAAe;"}